<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
        <title>fnl.es &middot; Articles by Florian Leitner</title>
        <link rel="shortcut icon" href="http://fnl.es/favicon.ico" />
        <link href="http://fnl.es/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="fnl.es Atom Feed" />
                        <link href="http://fnl.es/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="fnl.es RSS Feed" />
        
        <link rel="stylesheet" href="http://fnl.es/theme/css/screen.css" type="text/css" />
        <link rel="stylesheet" href="http://fnl.es/theme/css/pygments.css" type="text/css" />
    </head>
    <body>
        <div id="header">
            <ul id="nav">
                <li class="ephemeral selected"><a href="http://fnl.es/author/florian-leitner.html">Florian Leitner</a></li>
                <li><a class="flagred" href="http://fnl.es">Home</a></li>
                <li><a class="flagyellow" href="http://fnl.es/pages/about.html">About</a></li>
                  <li><a class="flagyellow" href="http://fnl.es/pages/projects.html">Projects</a></li>
                  <li><a class="flagred" href="http://fnl.es/archives.html">Archives</a></li>
            </ul>
            <div class="header_box">
                <h1><a href="http://fnl.es">fnl.es</a></h1>
                <h2>fnl en España</h2>
            </div>
        </div>
        <div id="wrapper">
            <div id="content">
                <h4 class="date">Mar 12,  2010</h4>
                <div class="post">
                    <h2 class="title">
                        <a href="http://fnl.es/rails-rspecing-controllers-with-declarative-authorization-and-authlogic.html" rel="bookmark" title="Permanent Link to &quot;Rails: RSpec'ing controllers with declarative authorization AND AuthLogic&quot;">Rails: RSpec'ing controllers with declarative authorization AND AuthLogic</a>
                    </h2>
                    
                    <p>I just had a rough time figuring out how to bypass all the security
features of the Rails project I am developing to write decent controller
specs with RSpec. I am using AuthLogic as authentication module and
declarative authorization (DA) for exactly that. However, when I started
to write controller specs that would simulate (HTTP) GET requests, I ran
into a wall: I simply could not digg what the cleanest way would be to
bypass both AuthLogic and DA. Finally, after finding the right queries
in Google, I managed to get the necessary snippets. To avoid that the
same tedious task might befall you, here's what you need to add, e.g.,
to your spec_helpers directory - I called the file
&quot;controller_helpers.rb&quot;:</p>
<pre class="literal-block">
module SessionHelper
  def current_user(stubs = {})
    &#64;current_user ||= mock_model(User, stubs)
  end

  def user_session(stubs = {}, user_stubs = {})
    &#64;current_user_session ||= mock_model(
      UserSession, { :user =&gt; current_user(user_stubs) }.merge(stubs)
    )
  end

  def login(session_stubs = {}, user_stubs = {})
    UserSession.stub!(:find).and_return(
      user_session(session_stubs, user_stubs)
    )
  end

  def logout()
    &#64;user_session = nil
  end

  def disable_authorization()
    Authorization.ignore_access_control(true)
  end
end
</pre>
<p>The trick is that, for AuthLogic, you can now &quot;authenticate&quot; the user
by the stubbed UserSession that returns a mocked User model. DA is less
complicated: the <tt class="docutils literal">disable_authorization()</tt> method is all that is
needed. Now, in your &quot;spec_helper.rb&quot;, you add this line to the top:</p>
<pre class="literal-block">
require File.dirname(__FILE__) + '/spec_helpers/controller_helpers'
</pre>
<p>And this line somewhere in the <tt class="docutils literal"><span class="pre">Spec::Runner.configure</span></tt> loop:</p>
<pre class="literal-block">
config.include(SessionHelper)
</pre>
<p>Now, in your controller specs, it is more than trivial to disable
authorization and authentication at once - simply add the following
line, e.g., to your <tt class="docutils literal"><span class="pre">before(:each)</span></tt> definitions:</p>
<pre class="literal-block">
disable_authorization &amp;&amp; login
</pre>
<p>Voila - your GET requests pass; and you can even add stubs to your
User model, if needed, by adding them as key-value pairs to the
<tt class="docutils literal">login()</tt> call above! So now you can get back to make your specs
pass...</p>


                    <div class="clear"></div>
                    <div class="info">
                        <a href="http://fnl.es/rails-rspecing-controllers-with-declarative-authorization-and-authlogic.html">posted at 12:00 P</a>&nbsp;&middot;&nbsp;<a href="http://fnl.es/category/misc.html" rel="tag">Misc</a>                        
                        <div class="tags">
                            <a href="http://fnl.es/tag/rspec.html">rspec</a>
                            <a href="http://fnl.es/tag/rails.html">rails</a>
                        </div>                        
                    </div>
                    <div class="clear"></div>
                </div>

                <h4 class="date">Mar 27,  2007</h4>
                <div class="post">
                    <h2 class="title">
                        <a href="http://fnl.es/skiing-in-spain.html" rel="bookmark" title="Permanent Link to &quot;Skiing in Spain&quot;">Skiing in Spain</a>
                    </h2>
                    
                    <p>Actually, when I decided to move to Spain I would never have thought of
skiing here. There are the Pyrenees, where you could expect some areas,
but I was not expecting anything anywhere else. Meanwhile, I have been
skiing in Asturias (north, center) and Sierra Nevada (south, with a view
of Africa!)... Especially the latter was quite convincing: a large skiing
area with a lot of people who can actually ski (for Tyrolean standards
quite hard to achieve!). Just thought it would be kind of crazy to be
skiing end of March in Spain, while having a glimpse at Africa and
enjoying almost 20 ˚C in the &quot;valley&quot; (that is, Granada).</p>
<p>While I am at it: Granada is quite a beautiful town, and naturally there
is the Alhambra to visit (but I did not enter: you have to reserve at
least 2 months ahead if you want to get in...). There are more foreigners
here than in Madrid, naturally, and it seems to have slightly less extreme
temperatures than the capital. Nice place to live, I guess: 1 hour for
skiing, 1 hour to the beach!</p>
<p>In summary, there are 3 decent areas for skiing in Spain: the Pyrenees,
Asturias and Granada/Sierra Nevada. I have not seen the first, but
everybody tells me it is the best place. Anyway, I'd say Granada is
definitely the fanciest and worth a visit, too. And then you can ski on
about any other mountain range here, too (e.g., Gredos, Guadarrama, etc.),
but for my taste, the slopes there are not quite as steep and long as I'd
like them.</p>
</p>

                    <div class="clear"></div>
                    <div class="info">
                        <a href="http://fnl.es/skiing-in-spain.html">posted at 12:00 P</a>&nbsp;&middot;&nbsp;<a href="http://fnl.es/category/misc.html" rel="tag">Misc</a>                        
                        <div class="tags">
                            <a href="http://fnl.es/tag/spain.html">Spain</a>
                            <a href="http://fnl.es/tag/skiing.html">skiing</a>
                        </div>                        
                    </div>
                    <div class="clear"></div>
                </div>

                <h4 class="date">Sep  7,  2007</h4>
                <div class="post">
                    <h2 class="title">
                        <a href="http://fnl.es/textmate-python-and-django-cheat-sheet.html" rel="bookmark" title="Permanent Link to &quot;TextMate Python and Django cheat sheet&quot;">TextMate Python and Django cheat sheet</a>
                    </h2>
                    
                    <p>After not finding anything appropriate, I decided to do my own reference
card (aka cheat sheet) for the pythonic and django commands you can use
in TextMate. If you want to have it, download it from <a class="reference external" href="http://www.scribd.com/doc/7759743/TextMate-PythonDjango-Cheat-Sheet">here</a>.</p>


                    <div class="clear"></div>
                    <div class="info">
                        <a href="http://fnl.es/textmate-python-and-django-cheat-sheet.html">posted at 12:00 P</a>&nbsp;&middot;&nbsp;<a href="http://fnl.es/category/misc.html" rel="tag">Misc</a>                        
                        <div class="tags">
                            <a href="http://fnl.es/tag/python.html">python</a>
                            <a href="http://fnl.es/tag/django.html">django</a>
                        </div>                        
                    </div>
                    <div class="clear"></div>
                </div>

                <div class="clear"></div>
                <div class="pages">                
                    <a href="http://fnl.es/author/florian-leitner3.html" class="prev_page">&larr;&nbsp;Previous</a>
                    <a href="http://fnl.es/author/florian-leitner5.html" class="next_page">Next&nbsp;&rarr;</a>
                    <span>Page 4 of 6</span>
                </div>

                <div class="clear"></div>
                <div id="footer">
                    <p>
                    Theme by <a href="http://nevanscott.com/">Nevan Scott</a>
                    &middot;
                    Modified by Florian Leitner
                    &middot;
                    <a class="atom" href="http://fnl.es/feeds/all.atom.xml">Feed</a>
                </div>
            </div>
            <div class="clear"></div>
        </div>
    </body>
</html>