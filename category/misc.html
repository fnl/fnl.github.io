<!DOCTYPE html>
<html lang="en">
    <head>
        <meta http-equiv="Content-type" content="text/html; charset=utf-8" />
				<meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>fnl.es &middot; articles in the "Misc" category</title>
        <link rel="shortcut icon" href="http://fnl.es/favicon.ico" />
<link href="http://fnl.es/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="fnl.es Atom Feed" />
        <link href="http://fnl.es/feeds/all.rss.xml" type="application/rss+xml" rel="alternate" title="fnl.es RSS Feed" />

        <link rel="stylesheet" href="http://fnl.es/theme/css/screen.css" type="text/css" />
        <link rel="stylesheet" href="http://fnl.es/theme/css/pygments.css" type="text/css" />
        <!-- Start of StatCounter Code for Default Guide -->
<script type="text/javascript">
var sc_project=3728421; 
var sc_invisible=1; 
var sc_security="a5624e69"; 
</script>
<script type="text/javascript"
src="http://www.statcounter.com/counter/counter.js"></script>
        <!-- End of StatCounter Code for Default Guide -->
    </head>
    <body>
        <!-- Start of StatCounter Code for Default Guide -->
<noscript><div class="statcounter"><a title="hit counter"
href="http://statcounter.com/free-hit-counter/"
target="_blank"><img class="statcounter"
src="http://c.statcounter.com/3728421/0/a5624e69/1/"
alt="hit counter"></a></div></noscript>
        <!-- End of StatCounter Code for Default Guide -->
<div id="header">
            <ul id="nav">
                <li class="ephemeral selected"><a href="http://fnl.es/category/misc.html">Misc</a></li>
                <li><a class="flagred" href="http://fnl.es">Home</a></li>
<li><a class="flagyellow" href="http://fnl.es/pages/about.html">About</a></li>
<li><a class="flagyellow" href="http://fnl.es/pages/projects.html">Projects</a></li>
<li><a class="flagred" href="http://fnl.es/archives.html">Archives</a></li>
            </ul>
            <div class="header_box">
                <h1><a href="http://fnl.es">fnl.es</a></h1>
                <h2><a href = "mailto:flo@fnl.es" id="webmaster">fnl</a> en Espa√±a</h2>            </div>
        </div>
        <div id="wrapper">
            <div id="content">
                <h4 class="date">Sep 2014</h4>

								<div class="mobile-hide">
									<a class="twitter-timeline" width="180px" data-dnt="true" data-chrome="noheader nofooter transparent" href="https://twitter.com/flowing" data-widget-id="393739277646852096"></a>
									<script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+"://platform.twitter.com/widgets.js";fjs.parentNode.insertBefore(js,fjs);}}(document,"script","twitter-wjs");</script>
								</div>
                <div class="post">
<h2 class="title">
                        <a href="http://fnl.es/medline-kung-fu.html" rel="bookmark" title="Permanent Link to &quot;MEDLINE Kung-Fu&quot;">MEDLINE Kung-Fu</a>
                    </h2>

                    <p>If you are a computational linguist, data analyst, or bioinformatician working with biological text corpora (on medicine, neuroscience, molecular biology, etc.), you will rather sooner than later need access to MEDLINE.
In my now nearly eight years of &quot;BioNLP&quot; (natural language processing for biology), I have not been able to locate a simple set of command-line tools to manage a MEDLINE DB mirror.
As I am inherently lazy, I therefore have worked out a number of highly useful BASH commands I regularly get back to and have written my own tool to create a DB mirror in <a class="reference external" href="http://www.postgresql.org/">Postgres</a> or <a class="reference external" href="http://sqlite.org/">SQLite</a>.</p>
<div class="section" id="synchronizing-the-medline-archives">
<h2>Synchronizing the MEDLINE archives</h2>
<p>First you will most likely need to actually download the MEDLINE archives, given that your institute has a (free) subscription to the archives.
If you are on a Mac, you are already provided with the necessary tools:
<tt class="docutils literal">mount_ftp</tt> and <tt class="docutils literal">rsync</tt> should be installed on every Mac.
If you are on Linux, the <tt class="docutils literal">curlftpfs</tt> package simulates a file system for a FTP site accessed with with the cURL library, doing the same thing as <tt class="docutils literal">mount_ftp</tt> on a Mac.
In other words, we will mount the MEDLINE baseline and updates directories from the FTP site as a file system and then synchronize them with our local copy of each directory.
To do the synchronization step, we will be using <tt class="docutils literal">rsync</tt>.
On a GNU/Linux machine, you can use your package manager to install <tt class="docutils literal">curlftpfs</tt> and <tt class="docutils literal">rsync</tt>, if they are not already present.
Once you have the packages installed, create a directory that acts as mount point, e.g., <tt class="docutils literal">ftpfs</tt>, as well as the <tt class="docutils literal">baseline</tt> directory, and the <tt class="docutils literal">updates</tt> directory.
Then, the relevant commands are:</p>
<ol class="arabic">
<li><p class="first">To synchronize the baseline directory (replace <tt class="docutils literal">curlftpfs</tt> with <tt class="docutils literal">mount_ftp</tt> on a Mac):</p>
<pre class="literal-block">
curlftpfs ftp://ftp.nlm.nih.gov/nlmdata/.medleasebaseline/gz/ ftp_mount/
rsync -r -t -v --progress ftp_mount/* baseline/
</pre>
</li>
<li><p class="first">To synchronize the updates directory (replace <tt class="docutils literal">curlftpfs</tt> with <tt class="docutils literal">mount_ftp</tt> on a Mac):</p>
<pre class="literal-block">
curlftpfs ftp://ftp.nlm.nih.gov/nlmdata/.medlease/gz/ ftp_mount/
rsync -r -t -v --progress ftp_mount/* updates/
</pre>
</li>
</ol>
<p>To unmount the FTP directories once rsync is done, you can use <tt class="docutils literal">fusermount <span class="pre">-u</span> ftp_mount</tt> on Linux and <tt class="docutils literal">umount ftp_mount</tt> on a Mac.
If you want to do the latter process regularly (MEDLINE by now supports daily updates), you might consider placing these commands into a script and adding it to your crontab.
With this, you now have the recipe to easily maintain an up-to-date copy of the MEDLINE FTP directory on your workstation.
And because you are using rsync, you do not have to worry about broken connections or errors - if the process breaks midway, it will restart exactly where it left off.</p>
</div>
<div class="section" id="creating-a-local-medline-database-from-the-archives">
<h2>Creating a local MEDLINE database from the archives</h2>
<p>Once the MEDLINE files are installed, it is possible to simply parse the XML and extract whatever you might need from them.
However, working this way will get cumbersome very fast, so placing the data into a well-structured database schema could help.
To do this, I have created <a class="reference external" href="https://pypi.python.org/pypi/medic">medic</a>, a Python command-line tool to bootstrap and manage a local MEDLINE repository.
All you need to have installed to get this tool to work is <a class="reference external" href="https://www.python.org/downloads/">Python3</a>; to install <a class="reference external" href="https://pypi.python.org/pypi/medic">medic</a> you then only need to execute <tt class="docutils literal">pip install medic</tt> (possible with the option <tt class="docutils literal"><span class="pre">--user</span></tt> if you are not allowed to administer the machine you are on).
Second, you need to decide which database you want to use for MEDLINE.
You can use either <a class="reference external" href="http://www.postgresql.org/">Postgres</a> or <a class="reference external" href="http://sqlite.org/">SQLite</a> as the backend with <a class="reference external" href="https://pypi.python.org/pypi/medic">medic</a> (medic uses SQL Alchemy as its ORM, so in theory, it should be possible to use medic with other DBs, too.)
Once you have the database installed and running (and CREATEd the DATABASE itself, in the case of Postgres), you are ready to load the baseline files.
As loading the DB through the ORM can be cumbersome for <a class="reference external" href="http://www.postgresql.org/">Postgres</a>, it is better to parse the data into text files and then load those in one go:</p>
<pre class="literal-block">
medic parse baseline/medline1?n*.xml.gz

for table in citations abstracts authors chemicals databases descriptors \
             identifiers keywords publication_types qualifiers sections;
  do psql medline -c &quot;COPY $table FROM '`pwd`/${table}.tab';&quot;;
done
</pre>
<p>If you are loading the files into <a class="reference external" href="http://sqlite.org/">SQLite</a>, you can load the data directly with <tt class="docutils literal">medic insert</tt>, although it will be considerably slower than the <a class="reference external" href="http://www.postgresql.org/">Postgres</a> option:</p>
<pre class="literal-block">
medic --url sqlite:///MEDLINE.db insert baseline/medline1?n*.xml.gz
</pre>
<p>Finally, to update the <a class="reference external" href="http://www.postgresql.org/">Postgres</a> database to the latest state from the <tt class="docutils literal">updates</tt> directory, you can run:</p>
<pre class="literal-block">
for file in updates/medline1?n*.xml.gz;
  do medic --update parse $file;
  # NB: the above command created the file &quot;delete.txt&quot; (a list of PMIDs to delete)
  medic delete delete.txt
  for table in citations abstracts authors chemicals databases descriptors\
               identifiers keywords publication_types qualifiers sections;
    do psql medline -c &quot;COPY $table FROM '`pwd`/${table}.tab';&quot;;
  done;
done;
</pre>
<p>Again, with <a class="reference external" href="http://sqlite.org/">SQLite</a> you can take the direct, but slower <tt class="docutils literal">medic update</tt> route:</p>
<pre class="literal-block">
medic --url sqlite:///MEDLINE.db update updates/medline1?n*.xml.gz
</pre>
<p>In theory, the insert/update commands can be used for Postgres, too, but that is only recommended if you are loading records in the thousands, not millions.</p>
</div>
<div class="section" id="extracting-medline-records-with-medic">
<h2>Extracting MEDLINE records with medic</h2>
<p>Right now, medic has no interface to query the full-text.
You can index the full-text with Postgres, but that is not particularly efficient.
The right way would be to index the abstracts with Lucene, but so far I have not gotten around to write an indexer for the data.
In other words, right now, you will have to find out on your own which PubMed citations (i.e., PMIDs) you want to work with.
Given one or a list of PMIDs, however, medic allows you to quickly pull the records in a number of formats:</p>
<ol class="arabic simple">
<li><tt class="docutils literal">medline</tt>: write the records, one per citation, in the official MEDLINE format.</li>
<li><tt class="docutils literal">tiab</tt>: only put the title and abstract, one pair per citations, into the files.</li>
<li><tt class="docutils literal">html</tt>: write all records into one large HTML file (&quot;corpus&quot;).</li>
<li><tt class="docutils literal">tsv</tt>: write the PMID, title, and abstract into one large TSV file, one citation per line.</li>
</ol>
<p>For example: <tt class="docutils literal">medic <span class="pre">--format</span> tiab <span class="pre">--pmid-lists</span> selected_pmids.txt</tt>, where <tt class="docutils literal">selected_pmids.txt</tt> is a file with one PMID per line, will create one file per citation, named <tt class="docutils literal"><span class="pre">&lt;PMID&gt;.txt</span></tt>.</p>
</div>
<div class="section" id="converting-dois-to-pmids">
<h2>Converting DOIs to PMIDs</h2>
<p>To finish, here is a nifty little command-line to convert a list of DOIs into a list of PMIDs by using the NCBI eUtils web service:</p>
<pre class="literal-block">
for doi in `cat dois.txt`;
  do pmid=`wget &quot;http://eutils.ncbi.nlm.nih.gov/entrez/eutils/esearch.fcgi?db=PubMed&amp;retmode=xml&amp;term=$doi&quot; -O - 2&gt; /dev/null | grep &quot;&lt;Id&gt;&quot; | sed -E 's|&lt;/?Id&gt;||g' | cut -f3`;
  echo $doi $pmid &gt;&gt; doi2pmid.txt;
done
</pre>
<p>If you use this much, you even might want to put that into a little script maybe.</p>
<p>Overall, this collection of tools should give you everything you need to quickly and efficiently work with MEDLINE's PubMed records. If you have not done already, please check out the &quot;full capabilities&quot; of <a class="reference external" href="https://pypi.python.org/pypi/medic">medic</a> and decide for yourself.</p>
</div>


                    <div class="clear"></div>
                    <div class="info">
<a href="http://fnl.es/medline-kung-fu.html">posted at %l:00 %P</a>&nbsp;&middot;&nbsp;<a href="http://fnl.es/category/misc.html" rel="tag">Misc</a>
                        <div class="tags">
                            <a href="http://fnl.es/tag/text-mining.html">text mining</a>
                            <a href="http://fnl.es/tag/python.html">python</a>
                            <a href="http://fnl.es/tag/bionlp.html">bionlp</a>
                            <a href="http://fnl.es/tag/pubmed.html">pubmed</a>
                        </div>
                    </div>
                    <div class="clear"></div>
                </div>

                <div class="clear"></div>
                <div class="pages">
                    <a href="http://fnl.es/category/misc2.html" class="next_page">Next&nbsp;&rarr;</a>
                    <span>Page 1 of 23</span>
                </div>

                <div class="clear"></div>
                <div id="footer">
                    <p>
                    <a class="atom" href="http://fnl.es/feeds/all.atom.xml">RSS Feed</a>
                    </p>
                </div>
            </div>
            <div class="clear"></div>
        </div>
    </body>
</html>